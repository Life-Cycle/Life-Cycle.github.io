<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Docker笔记, Hexo">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Docker笔记 | Hexo</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Docker笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/docker/">
                                <span class="chip bg-color">docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-09-04
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>docker学习</p>
</blockquote>
<ul>
<li>Docker概述</li>
<li>Docker安装</li>
<li>Docker命令</li>
<li>Docker镜像</li>
<li>数据卷</li>
<li>DockerFile</li>
<li>网络原理</li>
<li>IDEA整合Docker</li>
<li>Docker Compose</li>
<li>Docker Swarm</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44502509/article/details/106861797">参考文档</a></p>
<p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/434158">docker网络博客</a></p>
<h2 id="Docker基础"><a href="#Docker基础" class="headerlink" title="Docker基础"></a>Docker基础</h2><h3 id="Docker-概述"><a href="#Docker-概述" class="headerlink" title="Docker 概述"></a>Docker 概述</h3><h4 id="为什么出现？"><a href="#为什么出现？" class="headerlink" title="为什么出现？"></a>为什么出现？</h4><p>为了解决跨平台、环境的配置问题，发布项目的时候带上环境一起打包发布。</p>
<p>传统：开发jar，运维来做运行的事情</p>
<p>现在：开发打包部署上线，直接一套流程做完。</p>
<p>java — apk — 发布到应用商店 — 用户下载apk — 安装即可用</p>
<p>java — jar — 打包项目带上环境（镜像） — docker仓库 —  用户下载镜像 — 直接运行</p>
<p>docker思想来自于集装箱！</p>
<p>JRE – 多个应用，端口冲突，原来都是交叉的。</p>
<p>隔离：docker核心思想，打包装箱，每个箱子都是相互隔离的。</p>
<p>通过隔离机制，可以将服务器利用到极致。</p>
<h4 id="Docker历史"><a href="#Docker历史" class="headerlink" title="Docker历史"></a>Docker历史</h4><p>2013年docker开源。2014年4月docker1.0发布。</p>
<p>docker之所以火得这么快，是因为特别轻巧，秒级启动，体积小巧</p>
<p>docker是基于Go语言开发的，开源项目。</p>
<p>docker的官方文档非常详细。</p>
<h4 id="容器化技术"><a href="#容器化技术" class="headerlink" title="容器化技术"></a>容器化技术</h4><p>传统虚拟机，虚拟出一个硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</p>
<p><strong>容器化技术不是模拟出一个完整的操作性系统</strong>，每个容器都有一个属于自己的文件系统，相互隔离，互不影响。</p>
<ul>
<li>应用更快的交付和部署，打包镜像发布测试一键运行</li>
<li>升级和扩缩容；</li>
<li>简化系统运维</li>
<li>更高效的利用计算资源：docker是内核级的虚拟化，可以在一个物理机上运行很多的容器实例，服务器的性能可以被压榨到极致。</li>
</ul>
<hr>
<p><strong>docker架构图</strong></p>
<p><img src="https://docs.docker.com/engine/images/architecture.svg" alt="Docker Architecture Diagram"></p>
<p><strong>镜像(image)：</strong></p>
<p>docker镜像就是一个模板，通过该模板可以创建多个容器服务，服务和项目最后都是运行在容器中的</p>
<p><strong>容器(container)：</strong></p>
<p>就可以理解为一个非常简易的Linux系统，容器可以启动，停止，删除，还支持一些其他的基本命令。</p>
<p><strong>仓库(repository)：</strong></p>
<p>存放镜像的地方，有公有仓库和私有仓库，Docker hub是国外的速度慢，要配置成国内的比如阿里的进行镜像加速。</p>
<p><strong>Docker安装：</strong></p>
<p>参考官网：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p>
<p>docker默认工作路径：/var/lib/docker</p>
<hr>
<p><strong>docker 是如何工作的？</strong></p>
<p>Docker是一个Client-Server结构的系统，docker守护进程运行在主机上，通过socket从客户端访问。 docker-server接收到docker-client的指令就会执行这个指令。</p>
<p>docker为什么比虚拟机快？</p>
<p>1.docker有着比虚拟机更少的抽象层</p>
<p>2.docker利用的宿主机的内核，虚拟机需要GuestOS</p>
<p><img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1473564113,4288905819&fm=26&gp=0.jpg" alt="img"></p>
<p>新建容器的时候，docker不需要像虚拟机一样重新加载一个操作系统的内核，避免引导。虚拟机需要加载Guest OS，分钟级别的响应，而docker是利用的宿主机操作系统，省略了这个复杂的过程，秒级响应。</p>
<p><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=573148660,581415847&fm=11&gp=0.jpg" alt="img"></p>
<hr>
<h3 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h3><h4 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a><strong>帮助命令</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker info</span><br><span class="line">docker 命令 --help </span><br></pre></td></tr></table></figure>
<p>docker帮助文档的位置：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<h4 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h4><p><strong>docker images 查看所有本地的镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        8 months ago        13.3kB</span><br><span class="line">ubuntu              18.04               549b9b86cb8d        8 months ago        64.2MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项</span></span><br><span class="line">root@zxg-1:~# docker images --help</span><br><span class="line">Usage:  docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line">List images</span><br><span class="line">Options:</span><br><span class="line">  -a, --all             显示所有镜像 (default hides intermediate images)</span><br><span class="line">      --digests         Show digests</span><br><span class="line">  -q, --quiet           只显示镜像ID Only show numeric IDs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>docker search 搜索镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker search --help</span><br><span class="line">Usage:  docker search [OPTIONS] TERM</span><br><span class="line">Search the Docker Hub for images</span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print search using a Go template</span><br><span class="line">      --limit int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line">      </span><br><span class="line"><span class="meta">#</span><span class="bash"> 可选项，通过收藏来过滤</span></span><br><span class="line">--filter=STARS=3000 #搜索3000以上的收藏的镜像</span><br><span class="line"></span><br><span class="line">root@zxg-1:~# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql               MySQL is a widely used, open-source relation…   9928                [OK]</span><br><span class="line">mariadb             MariaDB is a community-developed fork of MyS…   3632                [OK]</span><br></pre></td></tr></table></figure>
<p><strong>docker pull 拉取镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker pull 镜像名[:tag]  ;如果不写 tag， 默认最新latest</span></span><br><span class="line"></span><br><span class="line">root@zxg-1:~# docker pull mysql</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">bf5952930446: Pull complete   # 分层下载，dockerimages的核心</span><br><span class="line">8254623a9871: Pull complete	# Linux联合文件系统，非常巧妙，如果下载其他版本有重叠文件就不用再下载</span><br><span class="line">938e3e06dac4: Pull complete</span><br><span class="line">ea28ebf28884: Pull complete</span><br><span class="line">f3cef38785c2: Pull complete</span><br><span class="line">894f9792565a: Pull complete</span><br><span class="line">1d8a57523420: Pull complete</span><br><span class="line">6c676912929f: Pull complete</span><br><span class="line">3cdd8ff735c9: Pull complete</span><br><span class="line">4c70cbe51682: Pull complete</span><br><span class="line">e21cf0cb4dc3: Pull complete</span><br><span class="line">28c36cd3abcc: Pull complete</span><br><span class="line">Digest: sha256:6ded54eb1e5d048d8310321ba7b92587e9eadc83b519165b70bbe47e4046e76a # 签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest </span><br><span class="line">docker.io/library/mysql:latest # 真实地址</span><br></pre></td></tr></table></figure>
<p>下载mysql5.7</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">bf5952930446: Already exists</span><br><span class="line">8254623a9871: Already exists</span><br><span class="line">938e3e06dac4: Already exists</span><br><span class="line">ea28ebf28884: Already exists</span><br><span class="line">f3cef38785c2: Already exists</span><br><span class="line">894f9792565a: Already exists</span><br><span class="line">1d8a57523420: Already exists </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 注意到上面的Already exists，这就是分成下载的好处，有重复的就需要在下载，极大的节省了内存，加快了安装速度</span></span></span><br><span class="line">5f09bf1d31c1: Pull complete</span><br><span class="line">1591b28581e8: Pull complete</span><br><span class="line">96ef942f7603: Pull complete</span><br><span class="line">2e009731422e: Pull complete</span><br><span class="line">Digest: sha256:1a83136153b238b659b0887ceb4e08275473af1eab2e67de4c22b37c5f4130cd</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>
<p>docker rmi 删除镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker rmi -f 3646af3dc14a # 删除指定容器</span><br><span class="line">root@zxg-1:~# docker rmi -f 容器id1 容器id2 容器id3  # 删除多个容器</span><br><span class="line">root@zxg-1:~# docker rmi -f $(docker images -aq) # 删除全部容器</span><br><span class="line">			  docker ps -a -q | xargs docker rm  # 也能删除全部容器，管道命令</span><br></pre></td></tr></table></figure>
<h4 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run [参数] image</span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明</span></span><br><span class="line">--name= &quot;&quot; 		给容器命名，用来区别容器</span><br><span class="line">-d				后台运行</span><br><span class="line">-it				使用交互方式运行，进入容器后查看内容</span><br><span class="line">-p				指定容器的端口，-p 8080:80 (主机：容器) 将主机的8080端口映射到容器80端口</span><br><span class="line">		-p ip:主机端口：容器端口</span><br><span class="line">		-p 主机端口：容器端口 (最常用)</span><br><span class="line">		-p 容器端口</span><br><span class="line">-P				随机指定端口，大写的P和小写的p有区别，大写是随机指定端口</span><br></pre></td></tr></table></figure>
<p>docker ps</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps [参数]</span><br><span class="line"><span class="meta">		#</span><span class="bash"> 不带参数，显示正在运行的容器</span></span><br><span class="line">-a 		# 列出所有创建的容器，包括运行的和停止的</span><br><span class="line">-n=2 	# 列出最近运行的2个容器</span><br></pre></td></tr></table></figure>
<p>ctrl + P + Q  容器不停止退出，必须是大写的P和Q</p>
<p>docker kill 强制停止当前容器</p>
<h4 id="Docker常用的其他命令"><a href="#Docker常用的其他命令" class="headerlink" title="Docker常用的其他命令"></a>Docker常用的其他命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker中一个常见的坑</span></span><br><span class="line">docker run -d centos 后台运行centos</span><br><span class="line">docker ps 会发现centos被停止了</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这是因为docker容器使用后台运行的时候，必须有一个前台进程；docker启动centos容器后，发现centos容器里面没有任何应用，就会认为这个容器没有提供服务了，就会自动停止这个容器。</span></span><br></pre></td></tr></table></figure>
<h5 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a><strong>查看日志</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf --tail [容器id]  # 查看容器日志</span><br><span class="line">	-t 		# 显示时间戳</span><br><span class="line">	-f 		# 连续输出</span><br><span class="line">	--tail 	# 输出日志条数</span><br><span class="line">	</span><br><span class="line">root@zxg-1:~# docker logs --help</span><br><span class="line">Usage:  docker logs [OPTIONS] CONTAINER</span><br><span class="line">Fetch the logs of a container</span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">自己编写一段shell脚本运行</span><br><span class="line">root@zxg-1:~# docker run -d ubuntu /bin/bash -c &quot;while true;do echo bupt808;sleep 1;done&quot;</span><br><span class="line">然后查看日志</span><br><span class="line">root@zxg-1:~# docker logs -tf --tail 10 ece238a4b788</span><br><span class="line">2020-09-05T04:07:02.544188968Z bupt808</span><br><span class="line">2020-09-05T04:07:03.545585115Z bupt808</span><br><span class="line">2020-09-05T04:07:04.546922049Z bupt808</span><br><span class="line">2020-09-05T04:07:05.548260630Z bupt808</span><br><span class="line">可以看到日志不断输出bupt808</span><br></pre></td></tr></table></figure>
<h5 id="查看容器中的进程信息"><a href="#查看容器中的进程信息" class="headerlink" title="查看容器中的进程信息"></a>查看容器中的进程信息</h5><p>docker top [容器id]</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker top 36b035f61882</span><br><span class="line">UID                 PID                 PPID                C                   STIME ..   </span><br><span class="line">root                5313                5277                0                   12:26       </span><br><span class="line">root                5701                5313                0                   12:26       </span><br></pre></td></tr></table></figure>
<h5 id="查看容器的元数据"><a href="#查看容器的元数据" class="headerlink" title="查看容器的元数据"></a>查看容器的元数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker inspect 36b035f61882</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    	# 可以看到容器的id(36b035f61882)只是这个Id的前几位</span><br><span class="line">        &quot;Id&quot;: &quot;36b035f6188281a0584ee11ab6af8147ef6da11ea9b1612b67dd28625a845581&quot;,</span><br><span class="line">        # 镜像创建的时间</span><br><span class="line">        &quot;Created&quot;: &quot;2020-09-05T04:26:10.351421746Z&quot;,</span><br><span class="line">        # 默认bash控制台</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        # 传递的参数</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo bupt808;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;exited&quot;,</span><br><span class="line">            &quot;Running&quot;: false,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 0,</span><br><span class="line">            &quot;ExitCode&quot;: 137,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-09-05T04:26:10.706090834Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;2020-09-05T04:27:07.517065566Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        。。。。</span><br></pre></td></tr></table></figure>
<h5 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h5><p>方式1：</p>
<p>docker exec -it [容器id] bashShell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it [容器id] /bin/bash</span><br></pre></td></tr></table></figure>
<p>方式2：</p>
<p>docker attach [容器id]</p>
<blockquote>
<p>方式1和方式2的区别：</p>
<p>exec：进入容器后开启一个新的终端，可以在里面重新进行操作。(常用)</p>
<p>attach：进入容器正在执行的终端，不会启动新的进程。</p>
</blockquote>
<h5 id="从容器内拷贝文件到主机"><a href="#从容器内拷贝文件到主机" class="headerlink" title="从容器内拷贝文件到主机"></a>从容器内拷贝文件到主机</h5><p>docker cp 容器id：容器内路径    目的主机路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入容器创建文件，退出容器</span></span><br><span class="line">root@zxg-1:~# docker exec -it 36b035f61882 /bin/bash</span><br><span class="line">root@36b035f61882:/# cd /home/</span><br><span class="line">root@36b035f61882:/home# touch test.java</span><br><span class="line">root@36b035f61882:/home# ls</span><br><span class="line">test.java</span><br><span class="line">root@36b035f61882:/home# exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件从容器拷贝到主机</span></span><br><span class="line">root@zxg-1:~# docker cp 36b035f61882:/home/test.java /home/test01.java</span><br><span class="line">root@zxg-1:~# cd /home/</span><br><span class="line">root@zxg-1:/home# ls</span><br><span class="line">test01.java  zxg</span><br></pre></td></tr></table></figure>
<h5 id="从主机拷贝文件到容器"><a href="#从主机拷贝文件到容器" class="headerlink" title="从主机拷贝文件到容器"></a>从主机拷贝文件到容器</h5><p>docker cp 目的主机路径 容器id：容器内路径</p>
<blockquote>
<p>拷贝是一个手动过程，未来使用    -v    卷的技术，可以将主机的文件和容器的文件打通</p>
</blockquote>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><h5 id="docker命令图谱"><a href="#docker命令图谱" class="headerlink" title="docker命令图谱"></a>docker命令图谱</h5><p><img src="https://ss.csdn.net/p?https://upload-images.jianshu.io/upload_images/4933701-c9c04d73e0eae5fd.png" alt="Docker命令_JunChow-CSDN博客_/root/rpmbuild/build/docker-ce/.gopath/src/github."></p>
<p><strong>docker命令：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line"><span class="meta">#</span><span class="bash">当前shell下 attach连接指定运行的镜像</span></span><br><span class="line">build       Build an image from a Dockerfile # 通过Dockerfile定制镜像</span><br><span class="line">commit      Create a new image from a container&#x27;s changes #提交当前容器为新的镜像</span><br><span class="line">cp          Copy files/folders between a container and the local filesystem #拷贝文件</span><br><span class="line">create      Create a new container #创建一个新的容器</span><br><span class="line">diff        Inspect changes to files or directories on a container&#x27;s filesystem #查看docker容器的变化</span><br><span class="line">events      Get real time events from the server # 从服务获取容器实时时间</span><br><span class="line">exec        Run a command in a running container # 在运行中的容器上运行命令</span><br><span class="line">export      Export a container&#x27;s filesystem as a tar archive #导出容器文件系统作为一个tar归档文件[对应import]</span><br><span class="line">history     Show the history of an image # 展示一个镜像形成历史</span><br><span class="line">images      List images #列出系统当前的镜像</span><br><span class="line">import      Import the contents from a tarball to create a filesystem image #从tar包中导入内容创建一个文件系统镜像</span><br><span class="line">info        Display system-wide information # 显示全系统信息</span><br><span class="line">inspect     Return low-level information on Docker objects #查看容器详细信息</span><br><span class="line">kill        Kill one or more running containers # kill指定docker容器</span><br><span class="line">load        Load an image from a tar archive or STDIN #从一个tar包或标准输入中加载一个镜像[对应save]</span><br><span class="line">login       Log in to a Docker registry #</span><br><span class="line">logout      Log out from a Docker registry</span><br><span class="line">logs        Fetch the logs of a container</span><br><span class="line">pause       Pause all processes within one or more containers</span><br><span class="line">port        List port mappings or a specific mapping for the container</span><br><span class="line">ps          List containers</span><br><span class="line">pull        Pull an image or a repository from a registry</span><br><span class="line">push        Push an image or a repository to a registry</span><br><span class="line">rename      Rename a container</span><br><span class="line">restart     Restart one or more containers</span><br><span class="line">rm          Remove one or more containers</span><br><span class="line">rmi         Remove one or more images</span><br><span class="line">run         Run a command in a new container</span><br><span class="line">save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">search      Search the Docker Hub for images</span><br><span class="line">start       Start one or more stopped containers</span><br><span class="line">stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">stop        Stop one or more running containers</span><br><span class="line">tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">top         Display the running processes of a container</span><br><span class="line">unpause     Unpause all processes within one or more containers</span><br><span class="line">update      Update configuration of one or more containers</span><br><span class="line">version     Show the Docker version information</span><br><span class="line">wait        Block until one or more containers stop, then print their exit codes</span><br></pre></td></tr></table></figure>
<p><strong>思考</strong>？</p>
<p>每次改动容器配置文件都需要通过命令<code>docker exec -it 容器id /bin/bash </code> 进入容器，十分麻烦。能够提供一个外部映射路径，通过在容器外部修改文件，容器内部就可以实现自动修改？ -v 数据卷技术！</p>
<h5 id="查看容器资源占用"><a href="#查看容器资源占用" class="headerlink" title="查看容器资源占用"></a>查看容器资源占用</h5><p>docker stats可以查看容器资源占比</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker stats</span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">5a31b9a0659d        nginx01             0.00%               5.168MiB / 125.8GiB   0.00%               5.15kB / 2.63kB     0B / 0B             2</span><br><span class="line">0656914b5ba1        mysql01             0.06%               199.4MiB / 125.8GiB   0.15%               14.8kB / 150kB      0B / 291MB          29</span><br><span class="line">59f47f9c8de7        gallant_neumann     0.00%               35.06MiB / 125.8GiB   0.03%               29.9MB / 297kB      0B / 32.7MB         1</span><br><span class="line">01b7e3cdd0e9        hopeful_elion       0.02%               376.7MiB / 125.8GiB   0.29%               20.9kB / 142kB      0B / 0B             67</span><br></pre></td></tr></table></figure>
<p>如果不想持续的监控容器使用资源的情况，可以通过 –no-stream 选项只输出当前的状态：<br><code>docker stats --no-stream</code>。</p>
<p>如果我们只想查看个别容器的资源使用情况，可以给 docker stats 命令显式的指定目标容器的名称或者是 ID.</p>
<p>比如启动elastic search，正常运行需要大约1.2G的内存，在普通阿里云服务器上回导致服务器卡顿，如何限制容器的内存资源，使用-e指令设置环境运行参数：**-e ES_JAVA_OPTS=”-Xms64m -Xmx512m”**</p>
<p><code>docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:tag</code></p>
<p><strong>docker网络问题：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20200806111139344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Nha2VyX18=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h4><ol>
<li>portainer<br><code>docker run -d -p 9001:9001 --name portainer_agent --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent </code></li>
<li>Rancher</li>
</ol>
<h3 id="Docker-镜像讲解"><a href="#Docker-镜像讲解" class="headerlink" title="Docker 镜像讲解"></a>Docker 镜像讲解</h3><h4 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h4><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>如何得到镜像：</p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝</li>
<li>自己制作一个镜像DockerFile</li>
</ul>
<h4 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h4><blockquote>
<p>UnionFS(联合文件系统)</p>
</blockquote>
<p>下载的时候看到的一层层就是这个。<br>UnionFS（联合文件系统）∶Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into asinglevirtual filesystem）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。<br>特性∶一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>bootfs（boot file system）主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。[个人理解：<em>bootfs用于开机，rootfs用于命令。</em>]<br>rootfs（root file system），在bootfs之上。包含的就是典型Linux系统中的/de，/proc，/bin，/etc等标准目录和文件。roots就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
<p><img src="https://img-blog.csdnimg.cn/20200802221508713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1Nha2VyX18=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G,为什么Docker这里才200M？为什么虚拟机很大，Docker很小？</p>
<p>对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版， bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以公用bootfs。<br>虚拟机是分钟级别，容器是秒级!</p>
<h4 id="分层原理"><a href="#分层原理" class="headerlink" title="分层原理"></a>分层原理</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker inspect 查看ubuntu镜像</span></span><br><span class="line">root@zxg-1:~# docker inspect ubuntu:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在输出的详细信息中，末尾有如下内容：</span></span><br><span class="line">&quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:2ce3c188c38d7ad46d2df5e6af7e7aed846bc3321bdd89706d5262fefd6a3390&quot;,</span><br><span class="line">                &quot;sha256:ad44aa179b334bbf4aeb61ecef978c3c77a3bb27cb28bcb727f5566d7f085b31&quot;,</span><br><span class="line">                &quot;sha256:35a91a75d24be7ff9c68ce618dcc933f89fef502a59becac8510dbc3bf7a4a05&quot;,</span><br><span class="line">                &quot;sha256:a4399aeb9a0e1ddf9da712ef222fd66f707a8c7205ed2607c9c8aac0dbabe882&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这就是该镜像的分层</span></span><br></pre></td></tr></table></figure>
<p>回顾之前下载mysql镜像的过程，输出如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">bf5952930446: Already exists</span><br><span class="line">8254623a9871: Already exists</span><br><span class="line">938e3e06dac4: Already exists</span><br><span class="line">5f09bf1d31c1: Pull complete</span><br><span class="line">1591b28581e8: Pull complete</span><br><span class="line">96ef942f7603: Pull complete</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从日志输出可以看到，镜像是在一层一层的下载。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到有的是显示Already exists的，这就是之前已经下载在本地的base镜像，不在需要重复下载。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示Pull complete的base镜像才是需要下载的部分，依次下载就可以完成拼接了。</span></span><br></pre></td></tr></table></figure>
<p>采用这种分层结构，最大的好处就是用于文件共享时。也就是说当有多个镜像从相同的base镜像构建而来时，那么宿主机只需要保留一份base镜像就可以了，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以共享。</p>
<p><strong>原理：</strong></p>
<p>所有的镜像都起源于一个基础镜像层，当进行修改或增加新内容的时候，就会在当前镜像层之上，创建一个新的镜像层。</p>
<p>举一个简单的例子,假如基于Ubuntu Linux 16.64创建一个新的镜像,这就是新镜像的第一层,如果在该镜像中添加python包,就会在该镜像之上创建第二个镜像层; 如果继续添加一个安全补丁,就会创建第三个镜像层</p>
<p>该镜像已经包含3个镜像层,如下图所示(这只是一个简单的例子)</p>
<p><img src="https://img-blog.csdnimg.cn/202006191829432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>在添加额外的镜像层的同时,镜像始终保持是当前所有镜像的组合,理解这一点非常重要,下图举了一个简单的例子,每个镜像层包含3个文件,而镜像包含了两个镜像层的6个文件</p>
<p><img src="https://img-blog.csdnimg.cn/2020061918295560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>下图中展示了一个稍微复杂的三层镜像,在外部看来整个镜像只有6个文件,这是因为最上层的文件7是文件5的一个更新版本</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183009764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这种情况下,上层镜像层中的文件覆盖了底层镜像层中的文件,这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多层镜像层对外展示为统一的文件系统。</p>
<p>Linux上可用的存储引擎有AUFS,Overlay2,Device Mapper,Btrfs以及ZFS,顾名思义,每种存储引擎都是基于Linux对应的文件系统或者块设备技术,并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windosfilter一种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]。</p>
<p>下图展示了与系统显示相同的三层镜像,所有的镜像层堆叠合并,对外提供统一的视图层</p>
<p><img src="https://img-blog.csdnimg.cn/20200619183024727.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>Docker镜像都是只读的,当容器启动时,一个新的可写层被加载到镜像的顶部!</strong><br><strong>这一层就是我们通常所说的容器层,容器之下的都叫镜像层</strong>。<br><img src="https://img-blog.csdnimg.cn/20200619183036853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h4 id="Commit-镜像"><a href="#Commit-镜像" class="headerlink" title="Commit 镜像"></a>Commit 镜像</h4><p><code>docker commit </code>提交容器为一个新的镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker commit --help</span><br><span class="line">Usage:  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line">Create a new image from a container&#x27;s changes</span><br><span class="line">Options:</span><br><span class="line">  -a, --author string    Author (e.g., &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;)</span><br><span class="line">  -c, --change list      Apply Dockerfile instruction to the created image</span><br><span class="line">  -m, --message string   Commit message</span><br><span class="line">  -p, --pause            Pause container during commit (default true)</span><br></pre></td></tr></table></figure>
<p>实战测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.启动一个默认的Tomcat</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.发现这个默认的Tomcat是没有webapps应用的。这是因为镜像的原因，官方默认webapps下面是没有文件的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.自己拷贝一个文件进去</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.将操作过的容器重新commit提交为一个镜像</span></span><br><span class="line">docker commit -a=&quot;xixi&quot; -m=&quot;add webapps&quot; 容器id tomcat02:1.0</span><br><span class="line"></span><br><span class="line">root@zxg-1:~# docker commit -a=&quot;xixi&quot; -m=&quot;add webapps&quot; 01b7e3cdd0e9 tomcat02:1.0</span><br><span class="line">sha256:eea9274829840d3a717bb28d411d770b31166fcc8a3e0cce116ab36b920149f8</span><br><span class="line">root@zxg-1:~# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat02            1.0                 eea927482984        3 seconds ago       652MB</span><br><span class="line">mysql               5.7                 d589ea3123e0        19 hours ago        448MB</span><br><span class="line">tomcat              latest              d5eef28cf41d        3 days ago          647MB</span><br><span class="line">hello-world         latest              bf756fb1ae65        8 months ago        13.3kB</span><br><span class="line">ubuntu              18.04               549b9b86cb8d        8 months ago        64.2MB</span><br></pre></td></tr></table></figure>
<h3 id="Docker容器数据卷"><a href="#Docker容器数据卷" class="headerlink" title="Docker容器数据卷"></a>Docker容器数据卷</h3><h4 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h4><p><strong>docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像!</p>
<p>如果数据都在容器中,那么我们容器删除,数据就会丢失! 需求: 数据可以持久化</p>
<p>MYSQL, 容器删了,删库跑路! <strong>需求: mysql数据可以存储在本地!</strong></p>
<p>容器之间可以有一个数据共享的技术! Docker 容器中产生的数据,同步到本地!</p>
<p>这就是卷技术! 目录的挂载,将容器内的目录挂载到Linux上面! </p>
<p><img src="https://img-blog.csdnimg.cn/20200619183052229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>总结一句话: 容器的持久化和同步操作! 容器间也可以数据共享的!</strong></p>
<h4 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h4><blockquote>
<p>方式一：直接使用 -v 命令来挂载</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录：容器内目录</span><br><span class="line"></span><br><span class="line">root@zxg-1:/home# docker run -it -v /home/testfile:/home ubuntu /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出容器到主机可以看到宿主机下多了一个testfile文件夹</span></span><br><span class="line">root@59f47f9c8de7:/# exit</span><br><span class="line">exit</span><br><span class="line">root@zxg-1:/home# ls</span><br><span class="line">testfile  zxg</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机里面新建一个test.java文件</span></span><br><span class="line">root@zxg-1:/home/testfile# touch test.java</span><br><span class="line">root@zxg-1:/home/testfile# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过命令docker inspect可以查看到容器挂载文件，如下所示:</span></span><br><span class="line">root@zxg-1:/home/testfile# docker inspect 59f47f9c8de7</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/testfile&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入到容器中/home目录下，可以看到在宿主机创建的test.java文件已经同步到容器内部了</span></span><br><span class="line">root@zxg-1:/home/testfile# docker exec -it 59f47f9c8de7 /bin/bash</span><br><span class="line">root@59f47f9c8de7:/# cd /home/</span><br><span class="line">root@59f47f9c8de7:/home# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中编辑test.java然后退出容器到宿主机查看</span></span><br><span class="line">root@59f47f9c8de7:/home# vim test.java</span><br><span class="line">root@59f47f9c8de7:/home# cat test.java</span><br><span class="line">this text is from docker container</span><br><span class="line">root@59f47f9c8de7:/home# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到容器内的内容同步到了宿主机上</span></span><br><span class="line">root@zxg-1:/home/testfile# ls</span><br><span class="line">test.java</span><br><span class="line">root@zxg-1:/home/testfile# cat test.java</span><br><span class="line">this text is from docker container</span><br></pre></td></tr></table></figure>
<p>从上面的实例可以看到，无论是在容器内部修改挂载的文件，还是在宿主机上面修改挂载的文件，都会将变化同步到另一端，<strong>可以将文件挂载理解为双向绑定，一边改变另一边也会同步</strong>。</p>
<h4 id="配置Mysql数据持久化"><a href="#配置Mysql数据持久化" class="headerlink" title="配置Mysql数据持久化"></a>配置Mysql数据持久化</h4><p>mysql数据本地化，可以将容器内的配置文件和数据持久化到本地，在容器内部，配置文件所在目录是<code>/etc/mysql/conf.d</code>，数据文件在<code>/var/lib/mysql</code>下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">官网参考指令：docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"></span><br><span class="line">docker -run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysqldocker/conf.d </span><br><span class="line">-v /home/mysqldocker/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 </span><br><span class="line">--name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建容器后到宿主机/home/mysqldocker/下可以看到conf和data</span></span><br><span class="line">root@zxg-1:/home# cd mysqldocker/</span><br><span class="line">root@zxg-1:/home/mysqldocker# ls</span><br><span class="line">conf  data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过Navicat连接到数据库并创建mydatabase数据库，可以在data里面看到数据已经同步到本地了</span></span><br><span class="line">root@zxg-1:/home/mysqldocker# cd data/</span><br><span class="line">root@zxg-1:/home/mysqldocker/data# ls</span><br><span class="line">auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mydatabase  performance_schema  public_key.pem   server-key.pem</span><br><span class="line">ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       mysql       private_key.pem     server-cert.pem  sys</span><br></pre></td></tr></table></figure>
<h4 id="匿名挂载和具名挂载"><a href="#匿名挂载和具名挂载" class="headerlink" title="匿名挂载和具名挂载"></a>匿名挂载和具名挂载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 1.匿名挂载 ###</span></span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 匿名挂载只写了容器内的路径，没有写宿主机路径，这时会在宿主机`/var/lib/docker/volume`路径下随机生成一个目录卷，数据存储在该目录下的_data下，这种不常用。</span></span><br><span class="line">root@zxg-1:~# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               7914ba576a82167886589ce1e382edfa270c603e26c432e7e1aa7701acd03df6</span><br><span class="line">root@zxg-1:~# cd /var/lib/docker/volumes/</span><br><span class="line">root@zxg-1:/var/lib/docker/volumes# ls</span><br><span class="line">7914ba576a82167886589ce1e382edfa270c603e26c432e7e1aa7701acd03df6  metadata.db</span><br><span class="line">root@zxg-1:/var/lib/docker/volumes# cd 7914ba576a82167886589ce1e382edfa270c603/</span><br><span class="line">root@zxg-1:/var/lib/docker/volumes/7914ba576a82167886589ce# ls</span><br><span class="line">_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 2.具名挂载 ###</span></span></span><br><span class="line">-v 宿主机文件目录:容器内路径</span><br><span class="line">docker run -d -P -v nginxConfig:/etc/nginx nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载下，只写了文件目录，但是没有给出宿主机的绝对路径，这时会在宿主机`/var/lib/docker/volumes`路径下生成该文件目录卷，数据存储在该卷_data下。</span></span><br><span class="line">root@zxg-1:~# docker run -d -P -v nginxConfig:/etc/nginx nginx</span><br><span class="line">d30753e7afe8110ff89b63812edf7deef55ebf2901bd8a99510ea24305c32b56</span><br><span class="line">root@zxg-1:~# docker volume inspect nginxConfig</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2020-09-06T14:26:02+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginxConfig/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginxConfig&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">root@zxg-1:~# cd /var/lib/docker/volumes/</span><br><span class="line">root@zxg-1:/var/lib/docker/volumes# ls</span><br><span class="line">7914ba576a82167886589ce1e382edfa270c603e26c432e7e1aa7701acd03df6  metadata.db  nginxConfig</span><br><span class="line"><span class="meta">#</span><span class="bash"> 具名挂载可以方便的找到一个卷，大多数情况下都用具名挂载</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有卷的情况</span></span><br><span class="line">docker volum ls</span><br><span class="line">root@zxg-1:/var/lib/docker/volumes# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               7914ba576a82167886589ce1e382edfa270c603e26c432e7e1aa7701acd03df6</span><br><span class="line">local               nginxConfig</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## 3.指定路径挂载 ###</span></span></span><br><span class="line">-v 宿主机路径:容器内路径</span><br></pre></td></tr></table></figure>
<p><strong>所有的docker容器内的卷,没有指定目录的情况下都是在/var/lib/docker/volumes/卷名/_data</strong></p>
<p>扩展：</p>
<blockquote>
<p>可以在容器挂载路径后面加上<code>:ro</code>或者<code>:rw</code>。表示只读或者可读可写。<code>ro</code>:readonly <code>rw</code>:readwrite</p>
<p>docker run -d -P -v nginxConfig:/etc/nginx:ro nginx</p>
</blockquote>
<h4 id="初识DockerFile"><a href="#初识DockerFile" class="headerlink" title="初识DockerFile"></a>初识DockerFile</h4><p>Dockerfile就是用来构建镜像文件的命令脚本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.在/home目录下新建docker-test-volume目录，新建一个dockerfile</span></span><br><span class="line">root@zxg-1:/home# mkdir docker-test-volume</span><br><span class="line">root@zxg-1:/home# cd docker-test-volume/</span><br><span class="line">root@zxg-1:/home/docker-test-volume# vim dockerfile1</span><br><span class="line">root@zxg-1:/home/docker-test-volume# cat dockerfile1</span><br><span class="line">FROM ubuntu						# 基本运行环境</span><br><span class="line">VOLUME [&quot;volume01&quot;, &quot;volume02&quot;] # 挂载卷，build生成的镜像运行时会自动将这两个卷挂载到宿主机</span><br><span class="line">CMD echo &quot;---build---finish---&quot;	# 输出提示</span><br><span class="line">CMD /bin/bash					# 设置进入容器后默认进入/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.使用dockerfile来build一个镜像</span></span><br><span class="line">root@zxg-1:/home/docker-test-volume# docker build -f dockerfile1 -t xixi/ubuntu:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM ubuntu</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 4e2eef94cd6b</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;, &quot;volume02&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 91194c5137f7</span></span><br><span class="line">Removing intermediate container 91194c5137f7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> a87564715daf</span></span><br><span class="line">Step 3/4 : CMD echo &quot;---build---finish---&quot;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> a2157e8b0183</span></span><br><span class="line">Removing intermediate container a2157e8b0183</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 5e0313e4283e</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 60f930858b50</span></span><br><span class="line">Removing intermediate container 60f930858b50</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0602950abf7f</span></span><br><span class="line">Successfully built 0602950abf7f</span><br><span class="line">Successfully tagged xixi/ubuntu:1.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像可以看到，xixi/ubutu镜像已经构建完成</span></span><br><span class="line">root@zxg-1:/home/docker-test-volume# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">xixi/ubuntu         1.0                 0602950abf7f        2 minutes ago       73.9MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.运行该镜像，进入容器后ls可以看到末尾有volume01和volume02两个卷已经挂载到宿主机上了</span></span><br><span class="line">root@zxg-1:/home/docker-test-volume# docker run -it xixi/ubuntu:1.0</span><br><span class="line">root@c4737c64fb5c:/# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Jul 29 01:29 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   1 root root 4096 Aug 19 21:14 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Jul 29 01:29 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jul 29 01:33 var</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这两个卷就是生成镜像的时候自动挂载的，数据卷目录，并且是匿名挂载</span></span><br><span class="line">drwxr-xr-x   2 root root 4096 Sep  7 02:59 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 Sep  7 02:59 volume02</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出容器，docker inspect c4737c64fb5c 可以查看到挂载详情</span></span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line"> &#123;</span><br><span class="line">  &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 是匿名挂载</span></span><br><span class="line">  &quot;Name&quot;:&quot;706e18964bc1a76184b0ece8719f3fed1926ce52624b5ddcf257a70dd95c93fe&quot;,</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 可以看到本地挂载路径</span></span><br><span class="line">  &quot;Source&quot;:&quot;/var/lib/docker/volumes/706e18964bc1a76184b0ece8719f3fed1926ce52624b5ddcf257a70dd95c93fe/_data&quot;,</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 数据卷名</span></span><br><span class="line">   &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">   &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">   &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">   &quot;RW&quot;: true,</span><br><span class="line">   &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.在容器内volume01卷内新建一个文件container.txt</span></span><br><span class="line">root@c4737c64fb5c:/# cd volume01</span><br><span class="line">root@c4737c64fb5c:/volume01# touch container.txt</span><br><span class="line">root@c4737c64fb5c:/volume01# ls</span><br><span class="line">container.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机挂载目录下可以看到contain.txt也被同步过来了</span></span><br><span class="line">root@zxg1:~# cd /var/lib/docker/volumes/706e18964bc1a76184b0ece87157a70dd95c93fe/_data</span><br><span class="line">root@zxg1:/var/lib/docker/volumes/706e18964bc1a76184b0ecf257a70dd95c93fe/_data# ls</span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>
<p>可以看到，在容器内的volume01和volume02都被挂载到宿主机了。这种方式在今后用的非常多，因为我们会经常自己构建镜像。如果构建镜像的时候没有挂载卷，可以使用之前的手动镜像挂载<code> -v 卷名：容器内路径</code></p>
<h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>数据卷容器就是利用一个容器里面的数据卷共享数据给其他容器，比如多个mysql容器之间共享数据，就可以将之后启动的容器的数据目录通过<code>volumes-from</code>挂载到之前的容器数据目录下。之后的容器挂载到之前容器的数据卷之后，即使把之前的容器数据卷删除，数据依然不会丢失，数据是双向同步的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.创建容器docker01</span></span><br><span class="line">root@zxg-1:/home# docker run -it --name docker01 xixi/ubuntu:1.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.创建容器docker02，通过volumes-from参数，从docker01数据卷处挂载数据</span></span><br><span class="line">root@zxg-1:~# docker run -it --name docker02 --volumes-from docker01 xixi/ubuntu:1.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.在docker02的volume01里面创建数据</span></span><br><span class="line">root@81e4d41533f4:/# cd volume01</span><br><span class="line">root@81e4d41533f4:/volume01# touch docker02</span><br><span class="line">root@81e4d41533f4:/volume01# ls</span><br><span class="line">docker02</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.在docker01里面查看volume01数据卷</span></span><br><span class="line">root@bc1cb1d107a7:/# cd volume01</span><br><span class="line">root@bc1cb1d107a7:/volume01# ls</span><br><span class="line">docker02</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到在docker02容器的数据卷中创建的数据被同步到了docker01容器里面</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同时尝试了其他文件，发现不能同步，只有volume01和volume02可以实现同步</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.删除docker02容器，无论是停止还是删除，发现volume01和volume02的数据都没有丢失。</span></span><br></pre></td></tr></table></figure>
<p>多个mysql实现数据共享</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker -run -d -p 3306:3306 -v /home/mysqldocker/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">root@zxg-1:~# docker -run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br></pre></td></tr></table></figure>
<p><strong>结论：</strong></p>
<p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器为止。</p>
<p>但是一旦将数据持久化到了本地，这个时候本地数据时不会被删除的。</p>
<h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><hr>
<p>DockerFile是用来构建docker镜像的文件!命令参数脚本!</p>
<p>构建步骤: </p>
<ol>
<li>编写一个dockerfile脚本</li>
<li>docker build 构建成为一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push发布镜像(Docker hub , 阿里云镜像仓库! )</li>
</ol>
<h4 id="Dockerfile构建过程"><a href="#Dockerfile构建过程" class="headerlink" title="Dockerfile构建过程"></a>Dockerfile构建过程</h4><p>很多指令:</p>
<ol>
<li>每个保留关键字(指令)都是必须要大写</li>
<li>执行从上到下顺序执行</li>
<li>‘#’ 表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层,并提交 !</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20200619183442209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h4 id="Dockerfile指令"><a href="#Dockerfile指令" class="headerlink" title="Dockerfile指令"></a>Dockerfile指令</h4><p><img src="https://yqfile.alicdn.com/3d070d8b05e2a2b905c35ee46a6fe0056ab95b09.png" alt="image"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM		# 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTAINER	# 维护者信息，姓名+邮箱</span><br><span class="line">RUN			# 构建进行时需要执行的命令</span><br><span class="line">ADD			# 往里面添加内容</span><br><span class="line">WORDDIR		# 镜像的工作目录</span><br><span class="line">VOLUME		# 挂载的目录</span><br><span class="line">EXPOSE		# 暴露端口</span><br><span class="line">CMD			# 指定这个容器启动的时候要运行的命令，只有最后一个才会生效，可被替代</span><br><span class="line">ENTRYPOINT	# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD		# 当构建一个被继承DokcerFile，这个时候就会运行ONBUILD，触发指令。</span><br><span class="line">COPY		# 类似ADD，将文件拷贝到镜像中</span><br><span class="line">ENV			# 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>
<p>CMD和ENTRYPOINT的区别：CMD会替换命令，后者是追加。比如有一条指令<code>ls -a</code>，在运行的时候如果指定了<code>docker run ls -l</code>这时如果是CMD那么被替换，如果是ENTRYPOINT则原来的<code>ls -a</code>不变，后面的<code>ls -l</code>被追加到后面。</p>
<h4 id="实战–完善centos镜像"><a href="#实战–完善centos镜像" class="headerlink" title="实战–完善centos镜像"></a>实战–完善centos镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.新建mydockerfile-centos，并编辑如下</span></span><br><span class="line">root@zxg-1:/home/dockerfile-test# vim mydockerfile-centos</span><br><span class="line">root@zxg-1:/home/dockerfile-test# cat mydockerfile-centos</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER zfl&lt;zhou.fulin@bupt.edu.cn&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;-----end-----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.运行build指令，编译生成镜像</span></span><br><span class="line">root@zxg-1:/home/dockerfile-test# docker build -f mydockerfile-centos -t xixi/centos:0.1 .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 其中一些输出提示如下</span></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 6bd3821e9404</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> e0b1d26c2cd8</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 02a5f200a1a3</span></span><br><span class="line">Removing intermediate container 02a5f200a1a3</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> dbe62592678b</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 05d6f7ec0313</span></span><br><span class="line">Removing intermediate container 05d6f7ec0313</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 1aaf0912878d</span></span><br><span class="line">Step 9/10 : CMD echo &quot;-----end-----&quot;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> af356b0429fe</span></span><br><span class="line">Removing intermediate container af356b0429fe</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 95238668ad32</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 2f06e1a27256</span></span><br><span class="line">Removing intermediate container 2f06e1a27256</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0af6d6b9a159</span></span><br><span class="line">Successfully built 0af6d6b9a159</span><br><span class="line">Successfully tagged xixi/centos:0.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.运行成功后查看镜像如下</span></span><br><span class="line">root@zxg-1:/home/dockerfile-test# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">xixi/centos         0.1                 0af6d6b9a159        About a minute ago   297MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.运行容器，可以看到vim和net-tool的指令都可以用了</span></span><br><span class="line">root@zxg-1:~# docker run -it xixi/centos:0.1</span><br><span class="line">[root@5e420722b75a local]# vim test</span><br><span class="line">[root@5e420722b75a local]# cat test</span><br><span class="line">xixixi</span><br><span class="line">hahahahah</span><br><span class="line">miaomiaomiaomaio</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到路径也是到指定的/usr/<span class="built_in">local</span>目录下</span></span><br><span class="line">[root@5e420722b75a local]# pwd</span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure>
<h4 id="查看镜像构建历史步骤"><a href="#查看镜像构建历史步骤" class="headerlink" title="查看镜像构建历史步骤"></a>查看镜像构建历史步骤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker history 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以查看上面构建的centos镜像如下</span></span><br><span class="line">root@zxg-1:~# docker history 0af6d6b9a159</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">0af6d6b9a159        5 minutes ago       /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B</span><br><span class="line">95238668ad32        5 minutes ago       /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">1aaf0912878d        5 minutes ago       /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span><br><span class="line">dbe62592678b        5 minutes ago       /bin/sh -c #(nop)  EXPOSE 80                    0B</span><br><span class="line">e0b1d26c2cd8        5 minutes ago       /bin/sh -c yum -y install net-tools          23.5MB</span><br><span class="line">ee9ced5f585e        5 minutes ago       /bin/sh -c yum -y install vim                57.9MB</span><br><span class="line">fe6cd27d196d        5 minutes ago       /bin/sh -c #(nop) WORKDIR /usr/local            0B</span><br><span class="line">3ebd54aedd4e        5 minutes ago       /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B</span><br><span class="line">cddfcfb65bab        5 minutes ago       /bin/sh -c #(nop)  MAINTAINER zfl&lt;zhou.fulin…   0B</span><br><span class="line">0d120b6ccaa8        4 weeks ago         /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B</span><br><span class="line">&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B</span><br><span class="line">&lt;missing&gt;           4 weeks ago         /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d… 215MB</span><br></pre></td></tr></table></figure>
<h4 id="实战-制作Tomcat镜像"><a href="#实战-制作Tomcat镜像" class="headerlink" title="实战-制作Tomcat镜像"></a>实战-制作Tomcat镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.首先下载apache-tomcat-9.0.37.tar.gz  jdk-8u261-linux-x64.tar.gz并上传到服务器</span></span><br><span class="line">root@zxg-1:/home/diytomcat# ls</span><br><span class="line">apache-tomcat-9.0.37.tar.gz  jdk-8u261-linux-x64.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.新建Dockerfile文件，编辑</span></span><br><span class="line">root@zxg-1:/home/diytomcat# vim Dockerfile</span><br><span class="line">root@zxg-1:/home/diytomcat# cat Dockerfile</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER zfl&lt;zhou.fulin@bupt.edu.cn&gt;</span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line">ADD apache-tomcat-9.0.37.tar.gz /usr/local/</span><br><span class="line">ADD jdk-8u261-linux-x64.tar.gz /usr/local/</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_261</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.37</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.37</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.37/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.37/logs/catalina.out</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.使用build命令构建镜像</span></span><br><span class="line">root@zxg-1:/home/diytomcat# docker build -t xixi/diytomcat:0.1 .</span><br><span class="line">Sending build context to Docker daemon  523.7MB</span><br><span class="line">Step 1/15 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0d120b6ccaa8</span></span><br><span class="line">Step 2/15 : MAINTAINER zfl&lt;zhou.fulin@bupt.edu.cn&gt;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> cddfcfb65bab</span></span><br><span class="line">Step 3/15 : COPY readme.txt /usr/local/readme.txt</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> d9cec554f16e</span></span><br><span class="line">Step 4/15 : ADD apache-tomcat-9.0.37.tar.gz /usr/local/</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> b7412f9b5175</span></span><br><span class="line">Step 5/15 : ADD jdk-8u261-linux-x64.tar.gz /usr/local/</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 5029834e3f0d</span></span><br><span class="line"> .........</span><br><span class="line">Successfully built 08df3d18b2c8</span><br><span class="line">Successfully tagged xixi/diytomcat:0.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.查看镜像如下</span></span><br><span class="line">root@zxg-1:/home/diytomcat# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">xixi/diytomcat      0.1                 08df3d18b2c8        About a minute ago   641MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.运行容器，注意到Tomcat用的是8080端口，不能写错，否则不能访问</span></span><br><span class="line">root@zxg-1:/home/diytomcat/webtest# docker run -d -p 9090:8080 --name diytomcat01 -v /home/diytomcat/webtest/webapps:/usr/local/apache-tomcat-9.0.37/webapps/test -v /home/diytomcat/webtest/tomcatlogs/:/usr/local/apache-tomcat-9.0.37/logs xixi/diytomcat:0.1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.在本地的/home/diytomcat/webtest/webapps目录下新建WEB-INFO目录如下</span></span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# mkdir WEB-INF</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# cd WEB-INF/</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# vim web.xml</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps/WEB-INF# cat web.xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;2.4&quot;</span><br><span class="line">    xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee</span><br><span class="line">        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 7.在/home/diytomcat/webtest/webapps下新建index.jsp</span></span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps/WEB-INF# cd ..</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# vim indext.jsp</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# ls</span><br><span class="line">index.jsp  WEB-INF</span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/webapps# cat index.jsp</span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;&gt;</span><br><span class="line">    &lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div style=&quot;margin-top:82px;text-align: center;&quot;&gt;欢迎进入登录界面&lt;/div&gt;&lt;hr&gt;&lt;/br&gt;&lt;/br&gt;</span><br><span class="line">        &lt;div style=&quot;text-align: center;&quot;&gt;</span><br><span class="line">              &lt;form action=&quot;/SHDemo/user/login&quot; method=&quot;post&quot;&gt;</span><br><span class="line">                username:&lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;&lt;/br&gt;&lt;/br&gt;</span><br><span class="line">                password:&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;&lt;/br&gt;</span><br><span class="line">                &lt;input type=&quot;submit&quot; value=&quot;login&quot; /&gt;</span><br><span class="line">              &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 8.访问 主机名:9090/<span class="built_in">test</span>/ 可以看到页面</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9.可以在本地/home/diytomcat/webtest/tomcatlogs查看日志</span></span><br><span class="line">root@zxg-1:/home/diytomcat/webtest/tomcatlogs# cat catalina.out</span><br></pre></td></tr></table></figure>
<h4 id="Docker全流程"><a href="#Docker全流程" class="headerlink" title="Docker全流程"></a>Docker全流程</h4><p><img src="https://static.packt-cdn.com/products/9781787120532/graphics/B06157_10_04-1.png" alt="Managing Docker Images with Ansible - Implementing DevOps with Ansible 2"></p>
<h3 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h3><hr>
<h4 id="理解docker0"><a href="#理解docker0" class="headerlink" title="理解docker0"></a>理解docker0</h4><p><img src="https://img-blog.csdnimg.cn/20200619184654885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>docker0是安装docker后就会有的一个虚拟网络；</p>
<p><img src="https://wiki.jikexueyuan.com/project/docker-technology-and-combat/images/network.png" alt="Docker 网络"></p>
<p>当 Docker 启动时，会自动在主机上创建一个 <code>docker0</code> 虚拟网桥，实际上是 Linux 的一个 bridge，可以理解为一个软件交换机。它会在挂载到它的网口之间进行转发。</p>
<p>同时，Docker 随机分配一个本地未占用的私有网段（在 <a target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc1918">RFC1918</a> 中定义）中的一个地址给 <code>docker0</code> 接口。比如典型的 <code>172.17.42.1</code>，掩码为 <code>255.255.0.0</code>。此后启动的容器内的网口也会自动分配一个同一网段（<code>172.17.0.0/16</code>）的地址。</p>
<p>当创建一个 Docker 容器的时候，同时会创建了一对 <code>veth pair</code> 接口（当数据包发送到一个接口时，另外一个接口也可以收到相同的数据包）。这对接口一端在容器内，即 <code>eth0</code>；另一端在本地并被挂载到 <code>docker0</code> 网桥，名称以 <code>veth</code> 开头（例如 <code>vethAQI2QT</code>）。通过这种方式，主机可以跟容器通信，容器之间也可以相互通信。Docker 就创建了在主机和所有容器之间一个虚拟共享网络。</p>
<p>我们每启动一个docker容器,docker0就会给docker容器分配一个ip,我们只要安装了docker,就会有一个网卡docker0,桥接模式,使用的技术是evth-pair技术!</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看Tomcat容器的网络，可以看到docker0给该容器分配的网络地址为94: eth0@if95</span></span><br><span class="line">root@zxg-1:~# docker exec -it 01b7e3cdd0e9 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">94: eth0@if95: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.5/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看主机网络情况。可以看到95: vethfd3f692@if94</span></span><br><span class="line">root@zxg-1:~# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">95: vethfd3f692@if94: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether 02:66:98:da:19:fc brd ff:ff:ff:ff:ff:ff link-netnsid 3</span><br><span class="line">    inet6 fe80::66:98ff:feda:19fc/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>我们发现这个容器的网卡, 都是一对对的</li>
<li>evth-pair 就是一对虚拟机设备接口,他们都是成对出现的,一端连着协议,一端彼此相连</li>
<li>正因为有这个特性,veth-pair 充当桥梁,连接各种虚拟网络设备的</li>
<li>openStac,Docker容器之间的连接,OVS的连接,都是使用 evth-pair 技术</li>
</ol>
</blockquote>
<h4 id="容器之间互ping"><a href="#容器之间互ping" class="headerlink" title="容器之间互ping"></a>容器之间互ping</h4><p>启动两个Tomcat容器，其中两个容器的ip地址分别为：172.17.0.5和172.17.0.2；互ping结果如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.查看两个容器的网络情况</span></span><br><span class="line">root@zxg-1:~# docker exec -it 7f1cc7e36c3b ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">88: eth0@if89: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.1另一个容器网络</span></span><br><span class="line">94: eth0@if95: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.5/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.容器互ping</span></span><br><span class="line">root@zxg-1:~# docker exec -it 7f1cc7e36c3b ping 172.17.0.5</span><br><span class="line">PING 172.17.0.5 (172.17.0.5) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.5: icmp_seq=1 ttl=64 time=0.166 ms</span><br><span class="line">64 bytes from 172.17.0.5: icmp_seq=2 ttl=64 time=0.048 ms</span><br><span class="line"></span><br><span class="line">root@zxg-1:~# docker exec -it 01b7e3cdd0e9 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.087 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.047 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 结论：容器和容器之间是可以互相ping通的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tomcat01和tomcat02是共用的一个路由器docker0。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所有的容器不指定网络的情况下,都是docker0路由的,docker会给我们的容器分配一个默认的可用IP。</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200619184934900.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>Docker中所有的网络接口都是虚拟的,虚拟的转发效率高</p>
<p>只要容器删除,对应网桥的一对就没了</p>
<h4 id="容器间互联"><a href="#容器间互联" class="headerlink" title="容器间互联"></a>容器间互联</h4><p>可以使用docker中<code>--link</code>参数实现容器互联，但是不建议该方法，正常情况都是通过自定义网络实现。</p>
<p><img src="https://img-blog.csdnimg.cn/20200619185017414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>本地探究 – link 就是我们在host配置中增加了一个172.18.0.3 tomcat02 312857784cd4</p>
<p>我们现在玩Docker已经不建议使用–link了!</p>
<p>自定义网络,不使用docker0!</p>
<p>docker0问题: 它不支持容器名连接访问!</p>
<h4 id="Docker自定义网络"><a href="#Docker自定义网络" class="headerlink" title="Docker自定义网络"></a>Docker自定义网络</h4><p>使用<code>docker network create </code>自定义网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker network --help</span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line">Manage networks</span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f67509b1ef30        bridge              bridge              local</span><br><span class="line">422b27f32439        hadoop              bridge              local</span><br><span class="line">3c4e8ad6ba2b        host                host                local</span><br><span class="line">6b0d26eb192b        none                null                local</span><br></pre></td></tr></table></figure>
<p>网络模式</p>
<ul>
<li>bridge : 桥接 docker 网桥</li>
<li>none: 不配置网络</li>
<li>host: 和宿主机共享网络</li>
<li>container: 容器内网络联通!</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.自定义网络</span></span><br><span class="line">root@zxg-1:~# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.查看自定义网络</span></span><br><span class="line">root@zxg-1:~# docker network inspect mynet</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.使用自定义网络 --net</span></span><br><span class="line">root@zxg-1:~# docker run -d -P --name tomcat-net-01 --net mynet tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.启动容器后再次查看自定义网络</span></span><br><span class="line">root@zxg-1:~# docker network inspect mynet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到如下内容</span></span><br><span class="line">       &quot;Containers&quot;: &#123;</span><br><span class="line">           &quot;2cea3bb29350ae99ce26c1bf6f8d1f2dcfb25bf8042193263ce275308e9eb42d&quot;: &#123;</span><br><span class="line">               &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">               &quot;EndpointID&quot;: &quot;ebff8e9ef22bd3d66d0de4229d1f3a3c610785b23005294f60f96f3089d52c3d&quot;,</span><br><span class="line">               &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">               &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">               &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">           &#125;,</span><br><span class="line">           &quot;336dd072ca17ac1adf514c44c8dcbd3358146d6d60667f3a0f99dbbb3e305f09&quot;: &#123;</span><br><span class="line">               &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">               &quot;EndpointID&quot;: &quot;69451bb0c95ed27d207cd2bade9c57fd2625c245b8b8cb3e5d0dea530a368683&quot;,</span><br><span class="line">               &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">               &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">               &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br></pre></td></tr></table></figure>
<p>现在不使用–link也可以ping名字了,推荐使用这种网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker exec tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.096 ms</span><br></pre></td></tr></table></figure>
<p>好处:</p>
<p>不同的集群使用ss不同的集群,保证集群之间是安全和健康的。</p>
<h4 id="自定义网络间容器联通"><a href="#自定义网络间容器联通" class="headerlink" title="自定义网络间容器联通"></a>自定义网络间容器联通</h4><p>如果有多个自定义网络，那么在默认情况下，各个自定义网络之间是无法ping通的。</p>
<p>如果需要互通，可以使用<code>docker network connect</code>连通自定义网络之间的容器。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@zxg-1:~# docker network connect --help</span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line">Connect a container to a network</span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将docker0网络下的容器tomcat01联通到mynet网络下</span></span><br><span class="line">root@zxg-1:~# docker network connect mynet tomcat01</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过inspect查看联通之后发生了什么</span></span><br><span class="line">root@zxg-1:~# docker network inspect mynet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到连通之后就是将 tomcat01 放到了mynet网络下</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 联通之后tomcat01就可以ping通mynet网络下的容器了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 但是联通仅仅限于tomcat01，和tomcat01位于同一docker0网络的其他容器依然不能ping通mynet里的容器。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也就是说，connect实现的不是网络和网络的联通，而是容器和网络的联通。</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200619185223260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUwMjUwOQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h3 id="Springboot微服务打包成Docker镜像"><a href="#Springboot微服务打包成Docker镜像" class="headerlink" title="Springboot微服务打包成Docker镜像"></a>Springboot微服务打包成Docker镜像</h3><hr>
<ol>
<li>构建springboot项目</li>
<li>打包成jar包</li>
<li>编写Dockerfile文件</li>
<li>将jar包和Dockerfile文件上传到服务器</li>
<li>在服务上运行<code>docker build -t xxxx:x.x .</code>构建镜像</li>
<li>运行镜像即可。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 编写Dockerfile文件</span></span><br><span class="line">FROM java:8</span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line">EXPOSE 8080</span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app.jar&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 将jar包和Dockerfile上传到服务器</span></span><br><span class="line">root@zxg-1:/home/idea# ls</span><br><span class="line">demo-0.0.1-SNAPSHOT.jar  Dockerfile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.docker build编译生成镜像</span></span><br><span class="line">root@zxg-1:/home/idea# docker build -t xixi/idea/testjar .</span><br><span class="line">Sending build context to Docker daemon  16.52MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">.....</span><br><span class="line">Successfully built 433cf62c1ac4</span><br><span class="line">Successfully tagged xixi/idea/testjar:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.查看镜像</span></span><br><span class="line">root@zxg-1:/home/idea# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">xixi/idea/testjar   latest              433cf62c1ac4        21 seconds ago      660MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.运行镜像</span></span><br><span class="line">root@zxg-1:/home/idea# docker run -d -P --name test-idea-jar xixi/idea/testjar</span><br><span class="line">25b7dde566912a4731e831dce3dcb18b2520f98862de51f05687e62a41b81fbf</span><br><span class="line">root@zxg-1:/home/idea# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS              PORTS                               NAMES</span><br><span class="line">25b7dde56691        xixi/idea/testjar    &quot;java -jar /app.jar …&quot;   49 seconds ago      Up 48 seconds       0.0.0.0:32768-&gt;8080/tcp             test-idea-jar</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.测试结果</span></span><br><span class="line">root@zxg-1:/home/idea# curl localhost:32768/hello</span><br><span class="line">hello xixi</span><br></pre></td></tr></table></figure>
<h2 id="Docker进阶"><a href="#Docker进阶" class="headerlink" title="Docker进阶"></a>Docker进阶</h2><p><img src="https://blog.54newpower.top/wp-content/uploads/2020/07/docker-cover.jpg" alt="img"></p>
<h3 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h3><h4 id="Docker-compose体验"><a href="#Docker-compose体验" class="headerlink" title="Docker-compose体验"></a>Docker-compose体验</h4><p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/gettingstarted/">docker compose官网例子</a></p>
<h4 id="Compose-file-规则"><a href="#Compose-file-规则" class="headerlink" title="Compose file 规则"></a>Compose file 规则</h4><p>docker-compose.yaml 是核心</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> compose file可以大致分为3层</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> version、services、networks</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其中最关键的就是 services 和 networks</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.版本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compose目前为止有三个版本分别为</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Version 1,Version 2,Version 3,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compose区分Version 1和Version 2</span></span><br><span class="line">version: &#x27;&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.服务</span></span><br><span class="line">service：</span><br><span class="line">	service1:</span><br><span class="line">		images</span><br><span class="line">		build</span><br><span class="line">		network</span><br><span class="line">		....</span><br><span class="line">	service2:</span><br><span class="line">		...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.其他配置，网络，卷挂载，全局规则等。。。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h3><h4 id="swarm初始化"><a href="#swarm初始化" class="headerlink" title="swarm初始化"></a>swarm初始化</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.init指令初始化swarm集群</span></span><br><span class="line">root@zxg-1:~# docker swarm init --advertise-addr 10.108.216.157</span><br><span class="line">Swarm initialized: current node (lbm8qox8gcy3e7e91yumkoyve) is now a manager.</span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line">    docker swarm join --token SWMTKN-1-4mls2dtx9k67yghv8vpt5n0hhbselaqfb0vsa72j0l52m9cm4t-57qi5xguzp2v9ywcpq5fi7q0z 10.108.216.157:2377</span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.在10.108.218.41中运行join提示，将其加入到swarm集群</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.在zxg-1主机中查看集群情况</span></span><br><span class="line">root@zxg-1:~# docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">pv2kozevs1k1attmyeyfnd782 *   zxg-1               Ready               Active              Leader              19.03.12</span><br><span class="line">txrjvzsnmos0ksl76wkf9c0v6     zxg-2               Ready               Active                                  18.09.7</span><br></pre></td></tr></table></figure>
<h4 id="docker-service-启动服务"><a href="#docker-service-启动服务" class="headerlink" title="docker service 启动服务"></a>docker service 启动服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.使用docker service启动服务</span></span><br><span class="line">root@zxg-1:~# docker service create -p 8888:8080 --name my-nginx nginx:latest</span><br><span class="line">sp5sckltl31y35qqesc97w974</span><br><span class="line">overall progress: 1 out of 1 tasks</span><br><span class="line">1/1: running   [==================================================&gt;]</span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.查看服务</span></span><br><span class="line">root@zxg-1:~# docker service ps my-nginx</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class="line">8gcf51hawdcr        my-nginx.1          nginx:latest        zxg-1               Running             Running 56 seconds ago</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.可以发现服务随机的被分配到任意一台主机上了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.不管服务启动在哪里，都可以通过主节点端口访问。</span></span><br></pre></td></tr></table></figure>
<p><code>docker run</code>和<code>docker service</code>区别</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker service 可以扩缩容，运行在不同的节点</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run 单机运行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.对my-nginx服务进行扩缩容</span></span><br><span class="line">root@zxg-1:~# docker service update --replicas 2 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 2 out of 2 tasks</span><br><span class="line">1/2: running   [==================================================&gt;]</span><br><span class="line">2/2: running   [==================================================&gt;]</span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.在另一台主机上查看服务，可以看到服务在另一台机器上也启动了</span></span><br><span class="line">root@zxg-2:~# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS                                              NAMES</span><br><span class="line">b27ff92b3184        nginx:latest        &quot;/docker-entrypoint.…&quot;   23 seconds ago      Up 22 seconds             80/tcp                                             my-nginx.2.r79zdtit5g</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.同样可以扩容十个二十个都可以，这样就可以实现动态的扩缩容，此处在缩减到1个如下所示：</span></span><br><span class="line">root@zxg-1:~# docker service update --replicas 1 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 1 out of 1 tasks</span><br><span class="line">1/1: running   [==================================================&gt;]</span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.实现动态扩缩容也可以使用docker service scale</span></span><br><span class="line">root@zxg-1:~# docker service scale my-nginx=3</span><br><span class="line">my-nginx scaled to 3</span><br><span class="line">overall progress: 3 out of 3 tasks</span><br><span class="line">1/3: running   [==================================================&gt;]</span><br><span class="line">2/3: running   [==================================================&gt;]</span><br><span class="line">3/3: running   [==================================================&gt;]</span><br><span class="line">verify: Service converged</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.分别在两台主机上查看，可以看到当前主机启动了一个，第二个主机启动了两个nginx容器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.移除服务docker service rm my-nginx</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">zhou-fulin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2020/09/04/Docker%E7%AC%94%E8%AE%B0/">http://example.com/2020/09/04/Docker%E7%AC%94%E8%AE%B0/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">zhou-fulin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/docker/">
                                    <span class="chip bg-color">docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/09/19/spring%E7%AC%94%E8%AE%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="spring笔记">
                        
                        <span class="card-title">spring笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-09-19
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            zhou-fulin
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/spring/">
                        <span class="chip bg-color">spring</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/04/28/Servlet%E7%AC%94%E8%AE%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="Servlet笔记">
                        
                        <span class="card-title">Servlet笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-04-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            zhou-fulin
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%89%8D%E5%90%8E%E7%AB%AF/">
                        <span class="chip bg-color">前后端</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">zhou-fulin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:zhou.fulin@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2808262126" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2808262126" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
